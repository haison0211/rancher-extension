(("undefined"!==typeof self?self:this)["webpackChunkrancher_node_filter_1_0_0"]=("undefined"!==typeof self?self:this)["webpackChunkrancher_node_filter_1_0_0"]||[]).push([[715],{32307:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var l=a(9274);const s={class:"label-filter-section mb-20"},o={class:"filter-row"},r=["placeholder","disabled"],n={key:0,class:"filter-info"},i=["onMouseenter","onMouseleave"],c=["colspan"],d={key:0},p={key:1,class:"mt-5"},u=["onClick"],m=["colspan"],h=["onMouseenter","onMouseleave"],f=["colspan"],b={key:0},g={key:1,class:"mt-5"},y=["onClick"],k=["colspan"];function v(e,t,a,v,w,N){const V=(0,l.resolveComponent)("LabeledSelect"),E=(0,l.resolveComponent)("Tag"),B=(0,l.resolveComponent)("PaginatedResourceTable"),x=(0,l.resolveComponent)("ResourceTable");return(0,l.openBlock)(),(0,l.createElementBlock)("div",null,[(0,l.createElementVNode)("div",s,[(0,l.createElementVNode)("div",o,[(0,l.createVNode)(V,{modelValue:e.selectedLabelKey,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedLabelKey=t),options:e.labelKeyOptions,label:e.t("node.list.labelFilter.labelKey"),placeholder:e.t("node.list.labelFilter.selectLabelKey"),class:"label-key-select"},null,8,["modelValue","options","label","placeholder"]),(0,l.withDirectives)((0,l.createElementVNode)("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.labelValue=t),type:"text",placeholder:e.t("node.list.labelFilter.labelValuePlaceholder"),disabled:!e.selectedLabelKey,class:"label-value-input"},null,8,r),[[l.vModelText,e.labelValue]]),e.selectedLabelKey||e.labelValue?((0,l.openBlock)(),(0,l.createElementBlock)("button",{key:0,class:"btn role-secondary clear-filter-btn",onClick:t[2]||(t[2]=(...t)=>e.clearLabelFilter&&e.clearLabelFilter(...t))},(0,l.toDisplayString)(e.t("node.list.labelFilter.clear")),1)):(0,l.createCommentVNode)("",!0)]),e.selectedLabelKey&&e.labelValue?((0,l.openBlock)(),(0,l.createElementBlock)("div",n,[t[3]||(t[3]=(0,l.createElementVNode)("i",{class:"icon icon-info"},null,-1)),(0,l.createElementVNode)("span",null,(0,l.toDisplayString)(e.t("node.list.labelFilter.filteringBy",{key:e.selectedLabelKey,value:e.labelValue,count:e.filteredRows.length})),1)])):(0,l.createCommentVNode)("",!0)]),e.hasActiveFilter?((0,l.openBlock)(),(0,l.createBlock)(x,(0,l.mergeProps)({key:1},e.$attrs,{schema:e.schema,rows:e.filteredRows,headers:e.headers,"sub-rows":!0,"data-testid":"cluster-node-list-filtered"}),{"sub-row":(0,l.withCtx)(({fullColspan:a,row:s,onRowMouseEnter:o,onRowMouseLeave:r})=>[(0,l.createElementVNode)("tr",{class:(0,l.normalizeClass)(["taints sub-row",{"empty-taints":!s.displayTaintsAndLabels}]),onMouseenter:o,onMouseleave:r},[s.displayTaintsAndLabels?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[t[6]||(t[6]=(0,l.createElementVNode)("td",null," ",-1)),t[7]||(t[7]=(0,l.createElementVNode)("td",null," ",-1)),(0,l.createElementVNode)("td",{colspan:a-2},[s.spec.taints&&s.spec.taints.length?((0,l.openBlock)(),(0,l.createElementBlock)("span",b,[(0,l.createTextVNode)((0,l.toDisplayString)(e.t("node.list.nodeTaint"))+": ",1),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(s.spec.taints,(e,t)=>((0,l.openBlock)(),(0,l.createBlock)(E,{key:t,class:"mr-5 mt-2"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.key)+"="+(0,l.toDisplayString)(e.value)+":"+(0,l.toDisplayString)(e.effect),1)]),_:2},1024))),128))])):(0,l.createCommentVNode)("",!0),s.customLabelCount?((0,l.openBlock)(),(0,l.createElementBlock)("span",g,[(0,l.createTextVNode)((0,l.toDisplayString)(e.t("node.list.nodeLabels"))+": ",1),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(s.customLabels,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("span",{key:t,class:"mt-5 labels"},[t<7?((0,l.openBlock)(),(0,l.createBlock)(E,{key:0,class:"mr-2 label"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e),1)]),_:2},1024)):t>6&&s.displayLabels?((0,l.openBlock)(),(0,l.createBlock)(E,{key:1,class:"mr-2 label"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e),1)]),_:2},1024)):(0,l.createCommentVNode)("",!0)]))),128)),s.customLabelCount>7?((0,l.openBlock)(),(0,l.createElementBlock)("a",{key:0,href:"#",onClick:(0,l.withModifiers)(t=>e.toggleLabels(s),["prevent"])},(0,l.toDisplayString)(e.t("node.list."+(s.displayLabels?"hideLabels":"showLabels"))),9,y)):(0,l.createCommentVNode)("",!0)])):(0,l.createCommentVNode)("",!0)],8,f)],64)):((0,l.openBlock)(),(0,l.createElementBlock)("td",{key:1,colspan:a},"   ",8,k))],42,h)]),_:1},16,["schema","rows","headers"])):((0,l.openBlock)(),(0,l.createBlock)(B,(0,l.mergeProps)({key:0},e.$attrs,{schema:e.schema,headers:e.headers,paginationHeaders:e.paginationHeaders,"sub-rows":!0,fetchSecondaryResources:e.fetchSecondaryResources,fetchPageSecondaryResources:e.fetchPageSecondaryResources,"use-query-params-for-simple-filtering":e.useQueryParamsForSimpleFiltering,"data-testid":"cluster-node-list"}),{"sub-row":(0,l.withCtx)(({fullColspan:a,row:s,onRowMouseEnter:o,onRowMouseLeave:r})=>[(0,l.createElementVNode)("tr",{class:(0,l.normalizeClass)(["taints sub-row",{"empty-taints":!s.displayTaintsAndLabels}]),onMouseenter:o,onMouseleave:r},[s.displayTaintsAndLabels?((0,l.openBlock)(),(0,l.createElementBlock)(l.Fragment,{key:0},[t[4]||(t[4]=(0,l.createElementVNode)("td",null," ",-1)),t[5]||(t[5]=(0,l.createElementVNode)("td",null," ",-1)),(0,l.createElementVNode)("td",{colspan:a-2},[s.spec.taints&&s.spec.taints.length?((0,l.openBlock)(),(0,l.createElementBlock)("span",d,[(0,l.createTextVNode)((0,l.toDisplayString)(e.t("node.list.nodeTaint"))+": ",1),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(s.spec.taints,(e,t)=>((0,l.openBlock)(),(0,l.createBlock)(E,{key:t,class:"mr-5 mt-2"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e.key)+"="+(0,l.toDisplayString)(e.value)+":"+(0,l.toDisplayString)(e.effect),1)]),_:2},1024))),128))])):(0,l.createCommentVNode)("",!0),s.customLabelCount?((0,l.openBlock)(),(0,l.createElementBlock)("span",p,[(0,l.createTextVNode)((0,l.toDisplayString)(e.t("node.list.nodeLabels"))+": ",1),((0,l.openBlock)(!0),(0,l.createElementBlock)(l.Fragment,null,(0,l.renderList)(s.customLabels,(e,t)=>((0,l.openBlock)(),(0,l.createElementBlock)("span",{key:t,class:"mt-5 labels"},[t<7?((0,l.openBlock)(),(0,l.createBlock)(E,{key:0,class:"mr-2 label"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e),1)]),_:2},1024)):t>6&&s.displayLabels?((0,l.openBlock)(),(0,l.createBlock)(E,{key:1,class:"mr-2 label"},{default:(0,l.withCtx)(()=>[(0,l.createTextVNode)((0,l.toDisplayString)(e),1)]),_:2},1024)):(0,l.createCommentVNode)("",!0)]))),128)),s.customLabelCount>7?((0,l.openBlock)(),(0,l.createElementBlock)("a",{key:0,href:"#",onClick:(0,l.withModifiers)(t=>e.toggleLabels(s),["prevent"])},(0,l.toDisplayString)(e.t("node.list."+(s.displayLabels?"hideLabels":"showLabels"))),9,u)):(0,l.createCommentVNode)("",!0)])):(0,l.createCommentVNode)("",!0)],8,c)],64)):((0,l.openBlock)(),(0,l.createElementBlock)("td",{key:1,colspan:a},"   ",8,m))],42,i)]),_:1},16,["schema","headers","paginationHeaders","fetchSecondaryResources","fetchPageSecondaryResources","use-query-params-for-simple-filtering"]))])}var w=a(25544),N=a(30797),V=a(8529),E=a(68774),B=a(52799),x=a(2841),L=a(50025),C=a(35664),M=a(59136),D=a(39669),P=a(65359),A=a(63679);const R=["beta.kubernetes.io","node.kubernetes.io"],S=["kubernetes.io/arch","kubernetes.io/hostname","kubernetes.io/os"];function F(e){return!!S.includes(e)||R.some(t=>e.startsWith(t))}function $(e,t,a){if(!t||!a.trim())return!0;const l=e.metadata?.labels||{},s=l[t];return!!s&&s.toLowerCase().includes(a.toLowerCase().trim())}var T=a(4364);function _(e){if(T.log("[RAM-DEBUG] Row structure:",{nodeName:e.metadata?.name||e.name,hasRamReserved:"ramReserved"in e,hasRamReservedPercentage:"ramReservedPercentage"in e,hasStatus:"status"in e,statusAllocatable:e.status?.allocatable?.memory,rowType:e.constructor?.name||typeof e}),"number"===typeof e.ramReservedPercentage)return T.log("[RAM-DEBUG] Using ramReservedPercentage:",e.ramReservedPercentage),e.ramReservedPercentage;if("number"===typeof e.ramReserved&&"number"===typeof e.ramUsage){const t=100*e.ramUsage/e.ramReserved;return T.log("[RAM-DEBUG] Calculated from model properties, RAM %:",t.toFixed(2)),t}return"number"===typeof e.ramUsagePercentage?(T.log("[RAM-DEBUG] Falling back to ramUsagePercentage:",e.ramUsagePercentage),e.ramUsagePercentage):(T.log("[RAM-DEBUG] No RAM data available, returning 0"),0)}var U=(0,l.defineComponent)({name:"ListNode",components:{PaginatedResourceTable:w.A,ResourceTable:N.A,Tag:V.A,LabeledSelect:A.A},mixins:[B.A],props:{resource:{type:String,required:!0},schema:{type:Object,required:!0},useQueryParamsForSimpleFiltering:{type:Boolean,default:!1},listComponent:{type:Boolean,default:!1}},data(){return{canViewPods:!!this.$store.getters["cluster/schemaFor"](C.Sm),canViewNormanNodes:!!this.$store.getters["rancher/schemaFor"](C.k$.NODE),canViewMgmtNodes:!!this.$store.getters["management/schemaFor"](C.Mc.NODE),canViewMachines:!!this.$store.getters["management/schemaFor"](C.Z7.MACHINE),canViewNodeMetrics:!!this.$store.getters["cluster/schemaFor"](C.$v.NODE),selectedLabelKey:null,labelValue:"",allLabelKeys:[]}},beforeUnmount(){this.canViewPods&&this.$store.dispatch("cluster/forgetType",C.Sm),this.$store.dispatch("cluster/forgetType",C.NW),this.$store.dispatch("cluster/forgetType",C.$v.NODE)},computed:{...(0,P.L8)(["currentCluster"]),kubeNodes(){return this.$store.getters["cluster/all"](this.resource)||[]},tableGroup:(0,M.AN)(M.EI),canPaginate(){const e={id:this.resource?.id||this.resource};return this.resource&&this.$store.getters["cluster/paginationEnabled"]?.(e)},headers(){const e=[...this.$store.getters["type-map/headersFor"](this.schema,!1)],t=e.findIndex(e=>"ram"===e.name);return-1!==t&&(e[t]={...e[t],value:_}),this.canViewPods&&e.splice(e.length-1,0,{...E.WM,breakpoint:D.c.DESKTOP,getValue:e=>e.podConsumedUsage}),e},paginationHeaders(){if(!this.canPaginate)return[];const e=[...this.$store.getters["type-map/headersFor"](this.schema,!0)];if(e){const t=e.findIndex(e=>"ram"===e.name);return-1!==t&&(e[t]={...e[t],value:_}),this.canViewPods&&e.splice(e.length-1,0,{...E.WM,breakpoint:D.c.DESKTOP,sort:!1,search:!1,getValue:e=>e.podConsumedUsage}),e}return T.warn("Nodes list expects pagination headers but none found"),[]},hasActiveFilter(){return!(!this.selectedLabelKey||!this.labelValue.trim())},labelKeyOptions(){const e=new Set,t=this.$store.getters["cluster/all"](this.resource)||[];return t.forEach(t=>{const a=t.metadata?.labels||{};Object.keys(a).forEach(t=>{F(t)||e.add(t)})}),Array.from(e).sort().map(e=>({label:e,value:e}))},filteredRows(){return this.selectedLabelKey&&this.labelValue.trim()?this.kubeNodes.filter(e=>$(e,this.selectedLabelKey,this.labelValue)):this.kubeNodes}},methods:{async loadMetrics(){if(this.canViewNodeMetrics){if(this.canPaginate){if(!this.kubeNodes.length)return;const e={force:!0,pagination:new L.YU({filters:new L.eY({fields:this.kubeNodes.map(e=>new L.Js({field:"metadata.name",value:e.id}))})})};await this.$store.dispatch("cluster/findPage",{type:C.$v.NODE,opt:e})}else await this.$store.dispatch("cluster/findAll",{type:C.$v.NODE,opt:{force:!0}});this.$forceUpdate()}},toggleLabels(e){e["displayLabels"]=!e.displayLabels},async fetchSecondaryResources({canPaginate:e}){if(e)return;const t=[];this.canViewMgmtNodes&&t.push(this.$store.dispatch("management/findAll",{type:C.Mc.NODE})),this.canViewNormanNodes&&t.push(this.$store.dispatch("rancher/findAll",{type:C.k$.NODE})),this.canViewMachines&&t.push(this.$store.dispatch("management/findAll",{type:C.Z7.MACHINE})),this.canViewPods&&this.$store.dispatch("cluster/findAll",{type:C.Sm}),await Promise.all(t)},async fetchPageSecondaryResources({canPaginate:e,force:t,page:a}){if(a?.length){if(this.canViewMgmtNodes&&this.canViewNormanNodes){this.canViewNormanNodes&&this.$store.dispatch("rancher/findAll",{type:C.k$.NODE});const e={force:t,pagination:new L.YU({filters:L.eY.createMultipleFields(a.map(e=>new L.Js({field:"status.nodeName",value:e.id})))})};this.$store.dispatch("management/findPage",{type:C.Mc.NODE,opt:e})}if(this.canViewMachines){const e=this.currentCluster.provClusterId?.split("/")[0];if(e){const l={force:t,namespaced:e,pagination:new L.YU({filters:L.eY.createMultipleFields(a.reduce((e,t)=>{const a=t.metadata?.annotations?.[x.qt.MACHINE_NAME];return a&&e.push(new L.Js({field:"metadata.name",value:a})),e},[]))})};this.$store.dispatch("management/findPage",{type:C.Z7.MACHINE,opt:l})}}if(this.canViewPods){const e={force:t,pagination:new L.YU({filters:L.eY.createMultipleFields(a.map(e=>new L.Js({field:"spec.nodeName",value:e.id})))})};this.$store.dispatch("cluster/findPage",{type:C.Sm,opt:e})}this.loadMetrics()}},clearLabelFilter(){this.selectedLabelKey=null,this.labelValue=""},async ensureAllNodesLoaded(){if(this.canPaginate&&this.hasActiveFilter)try{await this.$store.dispatch("cluster/findAll",{type:this.resource,opt:{force:!0}})}catch(e){T.error("[Node Filter] Failed to load all nodes:",e)}}},watch:{hasActiveFilter:{handler(e){e&&this.ensureAllNodesLoaded()},immediate:!1}}}),O=(a(58185),a(47433));const K=(0,O.A)(U,[["render",v],["__scopeId","data-v-1d6647af"]]);var j=K},39989:function(e,t,a){var l={"./management.cattle.io.fleetworkspace":75593,"./management.cattle.io.fleetworkspace.vue":75593,"./management.cattle.io.globalrole":39126,"./management.cattle.io.globalrole.vue":39126,"./management.cattle.io.project":11193,"./management.cattle.io.project.vue":11193,"./management.cattle.io.roletemplate":24093,"./management.cattle.io.roletemplate.vue":24093,"./mixin/roleDeletionCheck":93097,"./mixin/roleDeletionCheck.js":93097,"./pod":4563,"./pod.vue":4563};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(l,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return l[e]}s.keys=function(){return Object.keys(l)},s.resolve=o,e.exports=s,s.id=39989},56489:function(e,t,a){"use strict";a.r(t);var l=a(36758),s=a.n(l),o=a(40935),r=a.n(o),n=r()(s());n.push([e.id,".label-filter-section[data-v-1d6647af]{background:var(--box-bg);border:1px solid var(--border);border-radius:var(--border-radius);padding:15px;margin-bottom:20px}.label-filter-section .filter-row[data-v-1d6647af]{display:flex;gap:10px;align-items:flex-end}.label-filter-section .filter-row .label-key-select[data-v-1d6647af]{flex:1;min-width:200px;max-width:300px}.label-filter-section .filter-row .label-value-input[data-v-1d6647af]{flex:1;min-width:200px;max-width:300px;height:40px;padding:0 10px;border:1px solid var(--border);border-radius:var(--border-radius);background:var(--input-bg);color:var(--input-text)}.label-filter-section .filter-row .label-value-input[data-v-1d6647af]:disabled{opacity:.5;cursor:not-allowed}.label-filter-section .filter-row .label-value-input[data-v-1d6647af]:focus{outline:none;border-color:var(--primary)}.label-filter-section .filter-row .clear-filter-btn[data-v-1d6647af]{height:40px;padding:0 15px;white-space:nowrap}.label-filter-section .filter-info[data-v-1d6647af]{margin-top:10px;display:flex;align-items:center;gap:8px;color:var(--primary);font-size:14px}.label-filter-section .filter-info .icon-info[data-v-1d6647af]{font-size:16px}.labels[data-v-1d6647af]{display:inline;flex-wrap:wrap}.labels .label[data-v-1d6647af]{display:inline-block;margin-top:2px}.taints td[data-v-1d6647af]{padding-top:0}.taints td .tag[data-v-1d6647af]{margin-right:5px;display:inline-block;margin-top:2px}.taints.empty-taints[data-v-1d6647af]{height:0;line-height:0}.taints.empty-taints td[data-v-1d6647af]{padding:0}",""]),t["default"]=n},58185:function(e,t,a){var l=a(56489);l.__esModule&&(l=l.default),"string"===typeof l&&(l=[[e.id,l,""]]),l.locals&&(e.exports=l.locals);var s=a(74825).A;s("7d684f72",l,!0,{sourceMap:!1,shadowMode:!1})},93558:function(e,t,a){var l={"./classic/metadata.json":29621,"./csp/metadata.json":6471,"./federal/metadata.json":91862,"./harvester/metadata.json":51507,"./rgs/metadata.json":48401,"./suse/metadata.json":37259};function s(e){var t=o(e);return a(t)}function o(e){if(!a.o(l,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return l[e]}s.keys=function(){return Object.keys(l)},s.resolve=o,e.exports=s,s.id=93558}}]);
//# sourceMappingURL=rancher-node-filter-1.0.0.umd.min.list.js.map