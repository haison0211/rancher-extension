(("undefined"!==typeof self?self:this)["webpackChunkrancher_pod_metrics_1_0_0"]=("undefined"!==typeof self?self:this)["webpackChunkrancher_pod_metrics_1_0_0"]||[]).push([[332],{24401:function(e,t,a){"use strict";a.r(t);var s=a(36758),r=a.n(s),o=a(40935),i=a.n(o),n=i()(r());n.push([e.id,".resources[data-v-d3c81454]{display:flex;flex-direction:row;justify-content:space-between}.resources[data-v-d3c81454]>*{width:30%}.text-muted[data-v-d3c81454]{color:var(--muted)}.text-error[data-v-d3c81454]{color:var(--error);cursor:help}.icon-spin[data-v-d3c81454]{animation:spin-d3c81454 1s linear infinite}@keyframes spin-d3c81454{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}",""]),t["default"]=n},39989:function(e,t,a){var s={"./management.cattle.io.fleetworkspace":75593,"./management.cattle.io.fleetworkspace.vue":75593,"./management.cattle.io.globalrole":39126,"./management.cattle.io.globalrole.vue":39126,"./management.cattle.io.project":11193,"./management.cattle.io.project.vue":11193,"./management.cattle.io.roletemplate":24093,"./management.cattle.io.roletemplate.vue":24093,"./mixin/roleDeletionCheck":93097,"./mixin/roleDeletionCheck.js":93097,"./pod":4563,"./pod.vue":4563};function r(e){var t=o(e);return a(t)}function o(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=o,e.exports=r,r.id=39989},45452:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return $}});var s=a(9274);const r={key:1,class:"node"},o={class:"alerts"},i={class:"mt-20 resources"},n={key:0,class:"text-muted"},l=["title"],c=["title"],d={key:0,class:"text-muted"},m=["title"],u=["title"];function p(e,t,a,p,h,f){const g=(0,s.resolveComponent)("Loading"),v=(0,s.resolveComponent)("Alert"),y=(0,s.resolveComponent)("ConsumptionGauge"),b=(0,s.resolveComponent)("ResourceTable"),k=(0,s.resolveComponent)("Tab"),w=(0,s.resolveComponent)("DashboardMetrics"),M=(0,s.resolveComponent)("ResourceTabs");return e.$fetchState.pending?((0,s.openBlock)(),(0,s.createBlock)(g,{key:0})):((0,s.openBlock)(),(0,s.createElementBlock)("div",r,[t[3]||(t[3]=(0,s.createElementVNode)("div",{class:"spacer"},null,-1)),(0,s.createElementVNode)("div",o,[(0,s.createVNode)(v,{class:"mr-10",status:f.pidPressureStatus,message:e.t("node.detail.glance.pidPressure")},null,8,["status","message"]),(0,s.createVNode)(v,{class:"mr-10",status:f.diskPressureStatus,message:e.t("node.detail.glance.diskPressure")},null,8,["status","message"]),(0,s.createVNode)(v,{class:"mr-10",status:f.memoryPressureStatus,message:e.t("node.detail.glance.memoryPressure")},null,8,["status","message"]),(0,s.createVNode)(v,{status:f.kubeletStatus,message:e.t("node.detail.glance.kubelet")},null,8,["status","message"])]),(0,s.createElementVNode)("div",i,[(0,s.createVNode)(y,{"resource-name":e.t("node.detail.glance.consumptionGauge.cpu"),capacity:a.value.cpuCapacity,used:a.value.cpuUsage},null,8,["resource-name","capacity","used"]),(0,s.createVNode)(y,{"resource-name":e.t("node.detail.glance.consumptionGauge.memory"),capacity:a.value.ramReserved,used:a.value.ramUsage,units:f.memoryUnits,"number-formatter":f.memoryFormatter},null,8,["resource-name","capacity","used","units","number-formatter"]),(0,s.createVNode)(y,{"resource-name":e.t("node.detail.glance.consumptionGauge.pods"),capacity:a.value.podCapacity,used:a.value.podConsumed},null,8,["resource-name","capacity","used"])]),t[4]||(t[4]=(0,s.createElementVNode)("div",{class:"spacer"},null,-1)),(0,s.createVNode)(M,{value:a.value,mode:e.mode,"onUpdate:value":t[0]||(t[0]=t=>e.$emit("input",t))},{default:(0,s.withCtx)(()=>[h.podSchema?((0,s.openBlock)(),(0,s.createBlock)(k,{key:0,name:"pods",label:e.t("node.detail.tab.pods"),weight:4},{default:(0,s.withCtx)(()=>[(0,s.createVNode)(b,{"key-field":"_key",headers:f.podTableHeadersWithMetrics,rows:a.value.pods,"row-actions":!1,"table-actions":!1,search:!1},{"cell:cpu":(0,s.withCtx)(({row:e})=>[h.metricsLoading&&0===h.metricsMap.size?((0,s.openBlock)(),(0,s.createElementBlock)("span",n,t[1]||(t[1]=[(0,s.createElementVNode)("i",{class:"icon icon-spinner icon-spin"},null,-1)]))):h.metricsError?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:1,class:"text-error",title:h.metricsError}," Error ",8,l)):((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:2,title:`${f.getMetricsForPod(e).cpu} millicores`},(0,s.toDisplayString)(f.getMetricsForPod(e).cpuDisplay),9,c))]),"cell:memory":(0,s.withCtx)(({row:e})=>[h.metricsLoading&&0===h.metricsMap.size?((0,s.openBlock)(),(0,s.createElementBlock)("span",d,t[2]||(t[2]=[(0,s.createElementVNode)("i",{class:"icon icon-spinner icon-spin"},null,-1)]))):h.metricsError?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:1,class:"text-error",title:h.metricsError}," Error ",8,m)):((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:2,title:`${f.getMetricsForPod(e).memory} MiB`},(0,s.toDisplayString)(f.getMetricsForPod(e).memoryDisplay),9,u))]),_:1},8,["headers","rows"])]),_:1},8,["label"])):(0,s.createCommentVNode)("",!0),h.showMetrics?((0,s.openBlock)(),(0,s.createBlock)(k,{key:1,label:e.t("node.detail.tab.metrics"),name:"node-metrics",weight:3},{default:(0,s.withCtx)(e=>[e.active?((0,s.openBlock)(),(0,s.createBlock)(w,{key:0,"detail-url":h.NODE_METRICS_DETAIL_URL,"summary-url":h.NODE_METRICS_SUMMARY_URL,vars:f.graphVars,"graph-height":"875px"},null,8,["detail-url","summary-url","vars"])):(0,s.createCommentVNode)("",!0)]),_:1},8,["label"])):(0,s.createCommentVNode)("",!0),(0,s.createVNode)(k,{name:"info",label:e.t("node.detail.tab.info.label"),class:"bordered-table",weight:2},{default:(0,s.withCtx)(()=>[(0,s.createVNode)(b,{"key-field":"_key",headers:h.infoTableHeaders,rows:f.infoTableRows,"row-actions":!1,"table-actions":!1,"show-headers":!1,search:!1},null,8,["headers","rows"])]),_:1},8,["label"]),(0,s.createVNode)(k,{name:"images",label:e.t("node.detail.tab.images"),weight:1},{default:(0,s.withCtx)(()=>[(0,s.createVNode)(b,{"key-field":"_key",headers:h.imageTableHeaders,rows:f.imageTableRows,"row-actions":!1,"table-actions":!1},null,8,["headers","rows"])]),_:1},8,["label"]),(0,s.createVNode)(k,{name:"taints",label:e.t("node.detail.tab.taints"),weight:0},{default:(0,s.withCtx)(()=>[(0,s.createVNode)(b,{"key-field":"_key",headers:h.taintTableHeaders,rows:f.taintTableRows,"row-actions":!1,"table-actions":!1,search:!1},null,8,["headers","rows"])]),_:1},8,["label"])]),_:1},8,["value","mode"])]))}var h=a(46877),f=a(59065),g=a(55008),v=a(42411),y=a(68774),b=a(25403),k=a(35664),w=a(2517),M=a(95799),_=a(83030),E=a(65359),N=a(97348),C=a(87619),T=a(52799),S=a(50025),B=a(4364);const x="/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-grafana:80/proxy/d/rancher-node-detail-1/rancher-node-detail?orgId=1",P="/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-grafana:80/proxy/d/rancher-node-1/rancher-node?orgId=1";var D={name:"DetailNode",emits:["input"],components:{Alert:f.A,ConsumptionGauge:h.A,DashboardMetrics:_.A,Loading:C.A,ResourceTabs:b.A,Tab:v.A,ResourceTable:g.A},mixins:[w.A,T.A],props:{value:{type:Object,required:!0}},async fetch(){if(this.podSchema)if(this.filterByApi=this.$store.getters["cluster/paginationEnabled"](k.Sm),this.filterByApi){const e={pagination:new S.YU({sort:[{field:"metadata.name",asc:!0}],filters:S.eY.createSingleField({field:"spec.nodeName",value:this.value.id})})};this.$store.dispatch("cluster/findPage",{type:k.Sm,opt:e})}else this.$store.dispatch("cluster/findAll",{type:k.Sm});this.showMetrics=await(0,N.Qr)(this.$store,this.currentCluster.id,[x,P]),await this.loadPodMetrics(),this.startMetricsPolling()},data(){const e=this.$store.getters["cluster/schemaFor"](k.Sm);return{metrics:{cpu:0,memory:0},infoTableHeaders:[{...y._,label:"",width:200},{...y.Qg,label:"",dashIfEmpty:!0}],imageTableHeaders:[{...y.X0,width:null},{...y.sq,width:100}],taintTableHeaders:[y._,y.Qg,y.ac],podSchema:e,podTableHeaders:[],NODE_METRICS_DETAIL_URL:x,NODE_METRICS_SUMMARY_URL:P,showMetrics:!1,filterByApi:void 0,metricsMap:new Map,metricsLoading:!1,metricsError:null,refreshInterval:null,lastFetchTime:0}},computed:{...(0,E.L8)(["currentCluster"]),podTableHeadersWithMetrics(){if(!this.podSchema)return[];const e=this.$store.getters["type-map/headersFor"](this.podSchema)||[],t=e.findIndex(e=>"node"===e.name),a=e.findIndex(e=>"age"===e.name);let s=e.length;a>=0?s=a:t>=0&&(s=t+1);const r=[{name:"cpu",label:"CPU",value:"cpu",sort:["cpu"],width:120},{name:"memory",label:"RAM",value:"memory",sort:["memory"],width:120}];return[...e.slice(0,s),...r,...e.slice(s)]},clusterId(){return this.$route.params.cluster||"local"},memoryUnits(){const e=(0,M.$W)(this.value.ramReserved,1024);return`${M.QN[e]}iB`},pidPressureStatus(){return this.mapToStatus(this.value.isPidPressureOk)},diskPressureStatus(){return this.mapToStatus(this.value.isDiskPressureOk)},memoryPressureStatus(){return this.mapToStatus(this.value.isMemoryPressureOk)},kubeletStatus(){return this.mapToStatus(this.value.isKubeletOk)},infoTableRows(){return Object.keys(this.value.status.nodeInfo).map(e=>({key:this.t(`node.detail.tab.info.key.${e}`),value:this.value.status.nodeInfo[e]}))},imageTableRows(){const e=this.value.status.images||[];return e.map(e=>({name:e.names?e.names[1]||e.names[0]:"---",sizeBytes:e.sizeBytes}))},taintTableRows(){return this.value.spec.taints||[]},graphVars(){return{instance:`${this.value.internalIp}:9796`}}},methods:{memoryFormatter(e){const t={addSuffix:!1,increment:1024};return(0,M.Mo)(e,t)},mapToStatus(e){return e?"success":"error"},async loadMetrics(){const e=this.$store.getters["cluster/schemaFor"](k.$v.NODE);e&&(await this.$store.dispatch("cluster/find",{type:k.$v.NODE,id:this.value.id,opt:{force:!0}}),this.$forceUpdate())},async loadPodMetrics(){const e=Date.now();if(!(this.metricsLoading||e-this.lastFetchTime<2e3))try{this.metricsLoading=!0,this.metricsError=null,this.lastFetchTime=e;const{fetchPodMetrics:t}=await a.e(120).then(a.bind(a,10120)),s=await t(this.$store.$axios,this.clusterId);this.metricsMap=s}catch(t){B.error("[NodeDetail] Error loading pod metrics:",t),this.metricsError=t.message||"Failed to load metrics"}finally{this.metricsLoading=!1}},startMetricsPolling(){this.refreshInterval&&clearInterval(this.refreshInterval),this.refreshInterval=setInterval(()=>{this.loadPodMetrics()},1e4)},stopMetricsPolling(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},getMetricsForPod(e){const t=`${e.metadata?.namespace}/${e.metadata?.name}`,a=this.metricsMap.get(t);return a||{cpu:0,memory:0,cpuDisplay:"0.00 vCPU",memoryDisplay:"0 MiB"}}},beforeDestroy(){this.stopMetricsPolling()}},I=(a(72753),a(47433));const V=(0,I.A)(D,[["render",p],["__scopeId","data-v-d3c81454"]]);var $=V},72753:function(e,t,a){var s=a(24401);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var r=a(74825).A;r("aaa7b8fc",s,!0,{sourceMap:!1,shadowMode:!1})},93558:function(e,t,a){var s={"./classic/metadata.json":29621,"./csp/metadata.json":6471,"./federal/metadata.json":91862,"./harvester/metadata.json":51507,"./rgs/metadata.json":48401,"./suse/metadata.json":37259};function r(e){var t=o(e);return a(t)}function o(e){if(!a.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}r.keys=function(){return Object.keys(s)},r.resolve=o,e.exports=r,r.id=93558}}]);
//# sourceMappingURL=rancher-pod-metrics-1.0.0.umd.min.detail.js.map