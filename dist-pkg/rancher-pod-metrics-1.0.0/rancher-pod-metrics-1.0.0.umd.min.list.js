(("undefined"!==typeof self?self:this)["webpackChunkrancher_pod_metrics_1_0_0"]=("undefined"!==typeof self?self:this)["webpackChunkrancher_pod_metrics_1_0_0"]||[]).push([[120,715],{10120:function(e,t,r){"use strict";r.d(t,{fetchPodMetrics:function(){return l}});var s=r(4364);function n(e){if(!e||"string"!==typeof e)return 0;const t=e.trim();if(!t)return 0;if(t.endsWith("n")){const e=parseFloat(t.slice(0,-1));return isNaN(e)?0:e/1e6}if(t.endsWith("m")){const e=parseFloat(t.slice(0,-1));return isNaN(e)?0:e}{const e=parseFloat(t);return isNaN(e)?0:1e3*e}}function a(e){if(!e||"string"!==typeof e)return 0;const t=e.trim();if(!t)return 0;const r={Ki:1/1024,Mi:1,Gi:1024,Ti:1048576,K:1/1024/1.024,M:1/1.024,G:1e3,T:1024e3};for(const[n,a]of Object.entries(r))if(t.endsWith(n)){const e=parseFloat(t.slice(0,-n.length));return isNaN(e)?0:e*a}const s=parseFloat(t);return isNaN(s)?0:s/1048576}function o(e){if(!e||0===e)return"0.00 vCPU";const t=e/1e3;return`${t.toFixed(2)} vCPU`}function i(e){return e?e>=1024?`${(e/1024).toFixed(2)} GiB`:`${e.toFixed(0)} MiB`:"0 MiB"}function c(e){let t=0,r=0;if(!e||!e.containers||!Array.isArray(e.containers))return{cpu:0,memory:0,cpuDisplay:"0.00 vCPU",memoryDisplay:"0 MiB"};for(const s of e.containers)s&&s.usage&&(t+=n(s.usage.cpu),r+=a(s.usage.memory));return{cpu:t,memory:r,cpuDisplay:o(t),memoryDisplay:i(r)}}async function l(e,t,r){const n=new Map;if(!e||!t)return s.error("Invalid parameters for fetchPodMetrics"),n;try{const s=`/k8s/clusters/${t}/apis/metrics.k8s.io/v1beta1`,a=r?`${s}/namespaces/${r}/pods`:`${s}/pods`,o=await e.get(a),i=o.data;if(i&&i.items&&Array.isArray(i.items))for(const e of i.items)if(e.metadata&&e.metadata.namespace&&e.metadata.name){const t=`${e.metadata.namespace}/${e.metadata.name}`;n.set(t,c(e))}}catch(a){const e=a.message||"Unknown error";s.error("Failed to fetch pod metrics:",e)}return n}},39989:function(e,t,r){var s={"./management.cattle.io.fleetworkspace":75593,"./management.cattle.io.fleetworkspace.vue":75593,"./management.cattle.io.globalrole":39126,"./management.cattle.io.globalrole.vue":39126,"./management.cattle.io.project":11193,"./management.cattle.io.project.vue":11193,"./management.cattle.io.roletemplate":24093,"./management.cattle.io.roletemplate.vue":24093,"./mixin/roleDeletionCheck":93097,"./mixin/roleDeletionCheck.js":93097,"./pod":4563,"./pod.vue":4563};function n(e){var t=a(e);return r(t)}function a(e){if(!r.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=a,e.exports=n,n.id=39989},57147:function(e,t,r){"use strict";r.r(t);var s=r(36758),n=r.n(s),a=r(40935),o=r.n(a),i=o()(n());i.push([e.id,".text-muted[data-v-08f81b18]{color:var(--muted)}.text-error[data-v-08f81b18]{color:var(--error);cursor:help}.icon-spin[data-v-08f81b18]{animation:spin-08f81b18 1s linear infinite}@keyframes spin-08f81b18{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}",""]),t["default"]=i},69702:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(9274);const n={key:0,class:"text-muted"},a=["title"],o=["title"],i={key:0,class:"text-muted"},c=["title"],l=["title"];function m(e,t,r,m,u,d){const p=(0,s.resolveComponent)("ResourceTable");return(0,s.openBlock)(),(0,s.createBlock)(p,{schema:e.schema,headers:e.headers,"key-field":"id"},{"cell:cpu":(0,s.withCtx)(({row:r})=>[e.metricsLoading&&0===e.metricsMap.size?((0,s.openBlock)(),(0,s.createElementBlock)("span",n,t[0]||(t[0]=[(0,s.createElementVNode)("i",{class:"icon icon-spinner icon-spin"},null,-1)]))):e.metricsError?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:1,class:"text-error",title:e.metricsError}," Error ",8,a)):((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:2,title:`${e.getMetricsForPod(r).cpu} millicores`},(0,s.toDisplayString)(e.getMetricsForPod(r).cpuDisplay),9,o))]),"cell:memory":(0,s.withCtx)(({row:r})=>[e.metricsLoading&&0===e.metricsMap.size?((0,s.openBlock)(),(0,s.createElementBlock)("span",i,t[1]||(t[1]=[(0,s.createElementVNode)("i",{class:"icon icon-spinner icon-spin"},null,-1)]))):e.metricsError?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:1,class:"text-error",title:e.metricsError}," Error ",8,c)):((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:2,title:`${e.getMetricsForPod(r).memory} MiB`},(0,s.toDisplayString)(e.getMetricsForPod(r).memoryDisplay),9,l))]),_:1},8,["schema","headers"])}var u=r(55008),d=r(10120),p=r(4364),h=(0,s.defineComponent)({name:"PodListWithMetrics",components:{ResourceTable:u.A},props:{resource:{type:String,required:!0},schema:{type:Object,default:null}},data(){return{metricsMap:new Map,metricsLoading:!1,metricsError:null,refreshInterval:null,lastFetchTime:0,storeUnwatch:null}},computed:{clusterId(){const e=this.$route.params.cluster;return Array.isArray(e)?e[0]:e||"local"},headers(){const e=this.defaultHeaders||[],t=e.findIndex(e=>"node"===e.name),r=e.findIndex(e=>"age"===e.name);let s=e.length;r>=0?s=r:t>=0&&(s=t+1);const n=[{name:"cpu",label:"CPU",value:"cpu",sort:["cpu"],width:120},{name:"memory",label:"RAM",value:"memory",sort:["memory"],width:120}];return[...e.slice(0,s),...n,...e.slice(s)]},defaultHeaders(){return this.$store.getters["type-map/headersFor"](this.schema)||[]}},mounted(){this.loadMetrics(),this.setupStoreWatch(),this.startPolling(1e4),document.addEventListener("visibilitychange",this.handleVisibilityChange)},beforeUnmount(){this.stopPolling(),this.stopStoreWatch(),document.removeEventListener("visibilitychange",this.handleVisibilityChange)},methods:{getMetricsForPod(e){const t=`${e.metadata?.namespace}/${e.metadata?.name}`,r=this.metricsMap.get(t);return r||{cpu:0,memory:0,cpuDisplay:"0.00 vCPU",memoryDisplay:"0 MiB"}},startPolling(e=1e4){this.stopPolling(),this.refreshInterval=window.setInterval(()=>{this.loadMetrics()},e)},stopPolling(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},setupStoreWatch(){this.storeUnwatch=this.$store.watch((e,t)=>{const r=t["cluster/all"]("pod");return r?.length||0},(e,t)=>{e!==t&&this.loadMetrics()})},stopStoreWatch(){this.storeUnwatch&&(this.storeUnwatch(),this.storeUnwatch=null)},handleVisibilityChange(){document.hidden?this.startPolling(6e4):this.startPolling(1e4)},async loadMetrics(){const e=Date.now();if(!(this.metricsLoading||e-this.lastFetchTime<2e3))try{this.metricsLoading=!0,this.metricsError=null,this.lastFetchTime=e;const t=await(0,d.fetchPodMetrics)(this.$store.$axios,this.clusterId);this.metricsMap=t}catch(t){p.error("[PodMetrics] Error loading metrics:",t),this.metricsError=t.message||"Failed to load metrics"}finally{this.metricsLoading=!1}}}}),f=(r(88443),r(47433));const y=(0,f.A)(h,[["render",m],["__scopeId","data-v-08f81b18"]]);var g=y},88443:function(e,t,r){var s=r(57147);s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.id,s,""]]),s.locals&&(e.exports=s.locals);var n=r(74825).A;n("026a5653",s,!0,{sourceMap:!1,shadowMode:!1})},93558:function(e,t,r){var s={"./classic/metadata.json":29621,"./csp/metadata.json":6471,"./federal/metadata.json":91862,"./harvester/metadata.json":51507,"./rgs/metadata.json":48401,"./suse/metadata.json":37259};function n(e){var t=a(e);return r(t)}function a(e){if(!r.o(s,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return s[e]}n.keys=function(){return Object.keys(s)},n.resolve=a,e.exports=n,n.id=93558}}]);
//# sourceMappingURL=rancher-pod-metrics-1.0.0.umd.min.list.js.map